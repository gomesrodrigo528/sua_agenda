{% extends "base.html" %}

{% block title %}Dashboard - Sua Agenda{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/styles/dashboard.css">
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Header do Dashboard -->
    <div class="dashboard-header">
        <div class="header-content">
            <h1 class="dashboard-title">
                <i class="bi bi-speedometer2"></i>
                Dashboard
            </h1>
            <div class="header-date" id="data-atual">
                <!-- Data será preenchida via JavaScript -->
            </div>
        </div>
        <div class="refresh-btn" onclick="carregarDashboard()">
            <i class="bi bi-arrow-clockwise"></i>
        </div>
    </div>

    <!-- Cards de Métricas Principais -->
    <div class="metrics-grid">
        <!-- Faturamento do Dia -->
        <div class="metric-card primary">
            <div class="metric-icon">
                <i class="bi bi-currency-dollar"></i>
            </div>
            <div class="metric-content">
                <div class="metric-label">Faturamento Hoje</div>
                <div class="metric-value" id="faturamento-hoje">R$ 0,00</div>
            </div>
        </div>

        <!-- Atendimentos do Dia -->
        <div class="metric-card success">
            <div class="metric-icon">
                <i class="bi bi-calendar-check"></i>
            </div>
            <div class="metric-content">
                <div class="metric-label">Atendimentos Hoje</div>
                <div class="metric-value" id="atendimentos-hoje">0</div>
                <div class="metric-subtitle" id="atendimentos-concluidos">0 concluídos</div>
            </div>
        </div>

        <!-- Faturamento do Mês -->
        <div class="metric-card info">
            <div class="metric-icon">
                <i class="bi bi-graph-up"></i>
            </div>
            <div class="metric-content">
                <div class="metric-label">Faturamento Mês</div>
                <div class="metric-value" id="faturamento-mes">R$ 0,00</div>
            </div>
        </div>

        <!-- Meta do Mês -->
        <div class="metric-card warning" id="meta-card" style="display: none;">
            <div class="metric-icon">
                <i class="bi bi-target"></i>
            </div>
            <div class="metric-content">
                <div class="metric-label">Meta Mensal</div>
                <div class="metric-value" id="percentual-meta">0%</div>
                <div class="metric-subtitle" id="valor-meta">R$ 0,00</div>
            </div>
        </div>
    </div>

    <!-- Seção de Próximos Atendimentos -->
    <div class="dashboard-section">
        <div class="section-header">
            <h3><i class="bi bi-clock"></i> Próximos Atendimentos</h3>
            <a href="/agenda" class="btn-link">Ver Agenda</a>
        </div>
        <div class="atendimentos-list" id="proximos-atendimentos">
            <div class="loading-item">
                <div class="spinner"></div>
                <span>Carregando...</span>
            </div>
        </div>
    </div>

    <!-- Seção de Serviços Populares -->
    <div class="dashboard-section">
        <div class="section-header">
            <h3><i class="bi bi-star"></i> Serviços Populares</h3>
            <a href="/servicos" class="btn-link">Ver Serviços</a>
        </div>
        <div class="servicos-list" id="servicos-populares">
            <div class="loading-item">
                <div class="spinner"></div>
                <span>Carregando...</span>
            </div>
        </div>
    </div>

    <!-- Seção de Resumo Financeiro -->
    <div class="dashboard-section">
        <div class="section-header">
            <h3><i class="bi bi-pie-chart"></i> Resumo Financeiro</h3>
            <a href="/financeiro" class="btn-link">Ver Financeiro</a>
        </div>
        <div class="financeiro-grid">
            <!-- Contas a Receber -->
            <div class="financeiro-item">
                <div class="financeiro-label">Contas a Receber</div>
                <div class="financeiro-value" id="contas-pendentes">0</div>
                <div class="financeiro-subtitle" id="valor-pendente">R$ 0,00</div>
            </div>
            <div class="financeiro-item">
                <div class="financeiro-label">Contas Recebidas</div>
                <div class="financeiro-value" id="contas-pagas">0</div>
                <div class="financeiro-subtitle" id="valor-recebido">R$ 0,00</div>
            </div>
            <!-- Contas a Pagar -->
            <div class="financeiro-item">
                <div class="financeiro-label">Contas a Pagar</div>
                <div class="financeiro-value" id="contas-pagar-pendentes">0</div>
                <div class="financeiro-subtitle" id="valor-pagar-pendente">R$ 0,00</div>
            </div>
            <div class="financeiro-item">
                <div class="financeiro-label">Contas Pagas</div>
                <div class="financeiro-value" id="contas-pagar-pagas">0</div>
                <div class="financeiro-subtitle" id="valor-pago">R$ 0,00</div>
            </div>
            <!-- Entradas e Saídas -->
            <div class="financeiro-item">
                <div class="financeiro-label">Entradas do Mês</div>
                <div class="financeiro-value" id="entradas-mes">R$ 0,00</div>
            </div>
            <div class="financeiro-item">
                <div class="financeiro-label">Saídas do Mês</div>
                <div class="financeiro-value" id="saidas-mes">R$ 0,00</div>
            </div>
            <div class="financeiro-item">
                <div class="financeiro-label">Saldo do Mês</div>
                <div class="financeiro-value" id="saldo-mes">R$ 0,00</div>
            </div>
            <div class="financeiro-item">
                <div class="financeiro-label">Clientes Novos (7 dias)</div>
                <div class="financeiro-value" id="clientes-novos">0</div>
            </div>
        </div>
    </div>

    <!-- Gráfico de Faturamento -->
    <div class="dashboard-section">
        <div class="section-header">
            <h3><i class="bi bi-bar-chart"></i> Faturamento (7 dias)</h3>
        </div>
        <div class="chart-container">
            <canvas id="grafico-faturamento" width="400" height="200"></canvas>
        </div>
    </div>

    <!-- Ações Rápidas -->
    <div class="dashboard-section">
        <div class="section-header">
            <h3><i class="bi bi-lightning"></i> Ações Rápidas</h3>
        </div>
        <div class="acoes-grid">
            <a href="/agendamento" class="acao-btn">
                <i class="bi bi-plus-circle"></i>
                <span>Novo Agendamento</span>
            </a>
            <a href="/vendas" class="acao-btn">
                <i class="bi bi-cash-stack"></i>
                <span>Nova Venda</span>
            </a>
            <a href="/clientes" class="acao-btn">
                <i class="bi bi-person-plus"></i>
                <span>Novo Cliente</span>
            </a>
            <a href="/servicos" class="acao-btn">
                <i class="bi bi-gear"></i>
                <span>Gerenciar Serviços</span>
            </a>
        </div>
    </div>
</div>

<!-- Loading Overlay -->
<div id="dashboard-loading" class="loading-overlay">
    <div class="loading-content">
        <div class="spinner-large"></div>
        <p>Carregando dashboard...</p>
    </div>
</div>
{% endblock %}

{% block page_scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="/static/scripts/dashboard.js"></script>
{% endblock %}
